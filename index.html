<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slippers Multiplayer</title>
<style>
    body { margin:0; overflow:hidden; background:#111; }
    canvas { display:block; margin:0 auto; background:#222; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 600;

let playerId = null;
let player = { x: 400, y: 300, bullets: [] };
let players = {}; // all players from server
let keys = {};

const speed = 4;

// CONNECT TO YOUR PYTHON SERVER ðŸ‘‡
// CHANGE THIS AFTER DEPLOYING TO RENDER
const ws = new WebSocket("wss://ed-1-yazy.onrender.com");

ws.onopen = () => {
    console.log("Connected to server");
};

ws.onmessage = (msg) => {
    const data = JSON.parse(msg.data);

    // first message gives your player id
    if (data.type === "id") {
        playerId = data.id;
        return;
    }

    if (data.type === "state") {
        players = data.players;
    }
};

// controls
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

canvas.addEventListener("click", e => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    player.bullets.push({
        x: player.x,
        y: player.y,
        dx: (mx - player.x) / 15,
        dy: (my - player.y) / 15
    });
});

function updatePlayer() {
    if (!playerId) return; // not connected yet

    if (keys["w"] || keys["ArrowUp"]) player.y -= speed;
    if (keys["s"] || keys["ArrowDown"]) player.y += speed;
    if (keys["a"] || keys["ArrowLeft"]) player.x -= speed;
    if (keys["d"] || keys["ArrowRight"]) player.x += speed;

    // update bullets
    player.bullets.forEach(b => {
        b.x += b.dx;
        b.y += b.dy;
    });

    // send state to server
    if (ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({
            type: "update",
            state: player
        }));
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (!playerId) return;

    // draw all players
    for (let id in players) {
        const p = players[id];

        ctx.fillStyle = (id === playerId) ? "cyan" : "red";
        ctx.fillRect(p.x - 10, p.y - 10, 20, 20);

        // draw bullets
        if (p.bullets) {
            p.bullets.forEach(b => {
                ctx.fillStyle = (id === playerId) ? "yellow" : "orange";
                ctx.fillRect(b.x - 5, b.y - 5, 10, 10);
            });
        }
    }
}

function loop() {
    updatePlayer();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
