<!DOCTYPE html>
<html>
<head>
    <title>Slipper Game</title>
</head>
<body>
<canvas id="game" width="600" height="400" style="border:1px solid black"></canvas>

<script>
// AUTO-CONNECT to same domain
let ws = new WebSocket("wss://" + window.location.host + "/");

let canvas = document.getElementById("game");
let ctx = canvas.getContext("2d");

let player = { x: 300, y: 200 };
let others = {};

ws.onmessage = (event) => {
    let data = JSON.parse(event.data);
    others[data.id] = data;
};

ws.onopen = () => console.log("Connected!");

function sendPosition() {
    ws.send(JSON.stringify({
        id: Math.random().toString(36).substr(2, 9),
        x: player.x,
        y: player.y
    }));
}

document.addEventListener("keydown", (e) => {
    if (e.key === "ArrowUp") player.y -= 5;
    if (e.key === "ArrowDown") player.y += 5;
    if (e.key === "ArrowLeft") player.x -= 5;
    if (e.key === "ArrowRight") player.x += 5;
    sendPosition();
});

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // You
    ctx.fillStyle = "blue";
    ctx.fillRect(player.x - 10, player.y - 10, 20, 20);

    // Other players
    ctx.fillStyle = "red";
    for (let id in others) {
        let p = others[id];
        ctx.fillRect(p.x - 10, p.y - 10, 20, 20);
    }

    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
