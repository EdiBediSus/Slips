<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slipper Multiplayer</title>
<style>
  body { margin:0; overflow:hidden; background:#333; }
  canvas { display:block; margin:0 auto; background:#222; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 600;

let player = { x: 400, y: 300, color: "cyan" };
let bullets = [];
let players = {};
let keys = {};

const speed = 4;

// ===== CONNECT TO WEBSOCKET SERVER =====
const ws = new WebSocket("https://slips-2.onrender.com");

ws.onopen = () => console.log("Connected!");

ws.onmessage = msg => {
    players = JSON.parse(msg.data);
};

// ===== INPUT =====
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

canvas.addEventListener("click", e => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    bullets.push({
        x: player.x,
        y: player.y,
        dx: (mx - player.x) / 20,
        dy: (my - player.y) / 20
    });
});

// ===== GAME UPDATE =====
function update(){
    if(keys["w"] || keys["ArrowUp"]) player.y -= speed;
    if(keys["s"] || keys["ArrowDown"]) player.y += speed;
    if(keys["a"] || keys["ArrowLeft"]) player.x -= speed;
    if(keys["d"] || keys["ArrowRight"]) player.x += speed;

    bullets.forEach(b => { b.x += b.dx; b.y += b.dy; });

    // Send your state
    if(ws.readyState === 1){
        ws.send(JSON.stringify({
            x: player.x,
            y: player.y,
            bullets: bullets
        }));
    }
}

// ===== RENDER =====
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Self
    ctx.fillStyle = "cyan";
    ctx.fillRect(player.x - 10, player.y - 10, 20, 20);

    bullets.forEach(b => {
        ctx.fillStyle = "yellow";
        ctx.fillRect(b.x - 5, b.y - 5, 10, 10);
    });

    // Other players
    for(let id in players){
        const p = players[id];
        ctx.fillStyle = "red";
        ctx.fillRect(p.x - 10, p.y - 10, 20, 20);

        if(p.bullets){
            p.bullets.forEach(b => {
                ctx.fillStyle = "orange";
                ctx.fillRect(b.x - 5, b.y - 5, 10, 10);
            });
        }
    }
}

function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
